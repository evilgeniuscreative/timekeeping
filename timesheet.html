<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        />
        <title>Timesheet Dashboard</title>
        <link
            rel="icon"
            type="image/png"
            href="/favicon.png"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
        <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background-color: #f8fafc;
                color: #1a202c;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 2rem;
            }

            .header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 2rem;
            }

            .title {
                font-size: 2rem;
                font-weight: bold;
                color: #2d3748;
            }

            .btn {
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 0.5rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s;
            }

            .btn-primary {
                background-color: #3b82f6;
                color: white;
            }

            .btn-primary:hover {
                background-color: #2563eb;
            }

            .btn-success {
                background-color: #10b981;
                color: white;
                padding: 0.25rem 0.5rem;
                font-size: 0.875rem;
            }

            .btn-danger {
                background-color: #ef4444;
                color: white;
                padding: 0.25rem 0.5rem;
                font-size: 0.875rem;
            }

            .btn-small {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .stat-card {
                background: white;
                padding: 1.5rem;
                border-radius: 0.75rem;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                transition: transform 0.2s;
            }

            .stat-card:hover {
                transform: translateY(-2px);
            }

            .stat-title {
                font-size: 0.875rem;
                font-weight: 600;
                margin-bottom: 0.5rem;
            }

            .stat-value {
                font-size: 1.875rem;
                font-weight: bold;
            }

            .blue {
                color: #3b82f6;
            }
            .green {
                color: #10b981;
            }
            .yellow {
                color: #f59e0b;
            }
            .purple {
                color: #8b5cf6;
            }

            .rate-section {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1.5rem;
            }

            .rate-input {
                padding: 0.5rem;
                border: 1px solid #d1d5db;
                border-radius: 0.375rem;
                width: 100px;
            }

            .search-section {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1.5rem;
            }

            .search-input {
                padding: 0.5rem;
                border: 1px solid #d1d5db;
                border-radius: 0.375rem;
                width: 200px;
            }

            .pagination {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 1rem;
                padding: 1rem;
                background: white;
                border-radius: 0.5rem;
            }

            .table-container {
                background: white;
                border-radius: 0.75rem;
                overflow: hidden;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }

            table {
                width: 100%;
                border-collapse: collapse;
            }

            th,
            td {
                padding: 0.75rem;
                text-align: left;
                border-bottom: 1px solid #e5e7eb;
            }

            th {
                background-color: #f9fafb;
                font-weight: 600;
                color: #374151;
                cursor: pointer;
                user-select: none;
            }

            th:hover {
                background-color: #f3f4f6;
            }

            th.sortable::after {
                content: ' ↕';
                color: #9ca3af;
            }

            th.sort-asc::after {
                content: ' ↑';
                color: #3b82f6;
            }

            th.sort-desc::after {
                content: ' ↓';
                color: #3b82f6;
            }

            tr:hover {
                background-color: #f9fafb;
            }

            .editable {
                cursor: pointer;
                padding: 0.25rem;
                border-radius: 0.25rem;
                transition: background-color 0.2s;
            }

            .editable:hover {
                background-color: #dbeafe;
            }

            .edit-input {
                width: 100%;
                padding: 0.25rem;
                border: 1px solid #3b82f6;
                border-radius: 0.25rem;
            }

            .time-input {
                padding: 0.25rem;
                border: 1px solid #3b82f6;
                border-radius: 0.25rem;
                width: 140px;
            }

            .paid-row {
                background-color: #f0fdf4 !important;
            }

            .new-entry-row {
                background-color: #ffd700 !important;
            }

            .status-badge {
                padding: 0.25rem 0.5rem;
                border-radius: 0.375rem;
                font-size: 0.75rem;
                font-weight: 500;
            }

            .status-paid {
                background-color: #dcfce7;
                color: #166534;
            }

            .status-pending {
                background-color: #fef3c7;
                color: #92400e;
            }

            .actions {
                display: flex;
                gap: 0.5rem;
            }

            .empty-state {
                text-align: center;
                padding: 3rem;
                color: #6b7280;
            }

            .loading {
                text-align: center;
                padding: 2rem;
                color: #6b7280;
            }

            .week-separator {
                border-bottom: 2px solid #3b82f6 !important;
            }

            .month-separator {
                border-bottom: 2px solid #f59e0b !important;
            }

            .payday-input {
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }

            .payday-input input {
                width: 80px;
                padding: 0.25rem;
                border: 1px solid #3b82f6;
                border-radius: 0.25rem;
            }
        </style>
    </head>
    <body>
        <div id="root"></div>

        <script type="text/babel">
            const { useState, useEffect } = React;

            function TimesheetApp() {
                const [entries, setEntries] = useState([]);
                const [loading, setLoading] = useState(true);
                const [editingCell, setEditingCell] = useState(null);
                const [editValue, setEditValue] = useState('');
                const [hourlyRate, setHourlyRate] = useState(18.0); // Default to $18
                const [editingRate, setEditingRate] = useState(false);
                const [payingEntry, setPayingEntry] = useState(null);
                const [payAmount, setPayAmount] = useState('');
                const [currentPage, setCurrentPage] = useState(1);
                const [searchDate, setSearchDate] = useState('');
                const [sortField, setSortField] = useState('date');
                const [sortDirection, setSortDirection] = useState('desc');
                const [stats, setStats] = useState({
                    totalHours: 0,
                    totalPay: 0,
                    totalOwed: 0,
                    totalPaid: 0,
                });

                const API_BASE = '/api';
                const ENTRIES_PER_PAGE = 14;

                // Date formatting functions
                const formatDateForDisplay = (dateStr) => {
                    if (!dateStr) return '--/--/2025';
                    const date = new Date(dateStr + 'T00:00:00');
                    return date.toLocaleDateString('en-US'); // MM/DD/YYYY format
                };

                const formatDateForInput = (dateStr) => {
                    if (!dateStr) return '';
                    return dateStr; // YYYY-MM-DD for input[type="date"]
                };

                const parseDateFromInput = (inputValue) => {
                    return inputValue; // Already in YYYY-MM-DD format
                };

                // Time formatting functions - Fixed to properly handle 12-hour format
                const formatTimeForDisplay = (timeStr) => {
                    if (!timeStr) return '';
                    // Split only on first two colons to get HH:MM, ignore seconds
                    const timeParts = timeStr.split(':');
                    if (timeParts.length < 2) return timeStr;

                    const hours = parseInt(timeParts[0]);
                    const minutes = timeParts[1];
                    const ampm = hours >= 12 ? 'PM' : 'AM';
                    const displayHour =
                        hours === 0 ? 12
                        : hours > 12 ? hours - 12
                        : hours;
                    return `${displayHour}:${minutes} ${ampm}`;
                };

                const formatTimeForInput = (timeStr) => {
                    if (!timeStr) return '';
                    // Return only HH:MM format, strip seconds if present
                    const timeParts = timeStr.split(':');
                    if (timeParts.length >= 2) {
                        return `${timeParts[0]}:${timeParts[1]}`;
                    }
                    return timeStr;
                };

                const parseTimeFromInput = (inputValue) => {
                    return inputValue; // Already in HH:MM format
                };

                // FIXED: Check if an entry is complete for calculations
                const isEntryComplete = (entry) => {
                    return (
                        entry.date &&
                        entry.start_time &&
                        entry.end_time &&
                        entry.date.trim() !== '' &&
                        entry.start_time.trim() !== '' &&
                        entry.end_time.trim() !== ''
                    );
                };

                // Load hourly rate from database on component mount
                useEffect(() => {
                    loadHourlyRate();
                    fetchEntries();
                }, []);

                const loadHourlyRate = async () => {
                    try {
                        const response = await axios.get(
                            `${API_BASE}/settings.php?key=current_hourly_rate`
                        );
                        if (response.data && response.data.value) {
                            const rate = parseFloat(response.data.value);
                            console.log(
                                'Loaded hourly rate from database:',
                                rate
                            );
                            setHourlyRate(rate);
                        } else {
                            console.log(
                                'No rate found in database, using default $18.00'
                            );
                            // Set default rate in database
                            await saveHourlyRate(18.0);
                        }
                    } catch (error) {
                        console.error('Error loading hourly rate:', error);
                        setHourlyRate(18.0); // Fallback to $18
                    }
                };

                const saveHourlyRate = async (rate) => {
                    try {
                        await axios.post(`${API_BASE}/settings.php`, {
                            key: 'current_hourly_rate',
                            value: rate.toString(),
                        });
                        console.log('Saved hourly rate to database:', rate);
                    } catch (error) {
                        console.error('Error saving hourly rate:', error);
                    }
                };

                // FIXED: Improved base pay persistence logic
                const updateHourlyRate = async (newRate) => {
                    setHourlyRate(newRate);
                    await saveHourlyRate(newRate);

                    // Update ONLY unpaid entries with new rate
                    const updatedEntries = entries.map((entry) => {
                        const paidAmount = parseFloat(entry.paid) || 0;
                        if (paidAmount === 0) {
                            return { ...entry, pay_rate: newRate };
                        }
                        return entry;
                    });

                    // Save updated rates to database for unpaid entries only
                    for (const entry of updatedEntries) {
                        const paidAmount = parseFloat(entry.paid) || 0;
                        if (paidAmount === 0) {
                            await updateField(entry.id, 'pay_rate', newRate);
                        }
                    }

                    fetchEntries(); // Refresh to get updated data
                };

                const fetchEntries = async () => {
                    try {
                        setLoading(true);
                        const response = await axios.get(
                            `${API_BASE}/entries.php`
                        );
                        console.log('API Response:', response.data);
                        setEntries(
                            Array.isArray(response.data) ? response.data : []
                        );
                        calculateStats(
                            Array.isArray(response.data) ? response.data : []
                        );
                    } catch (error) {
                        console.error('Error fetching entries:', error);
                        setEntries([]);
                    } finally {
                        setLoading(false);
                    }
                };

                // FIXED: Only calculate stats for complete entries
                const calculateStats = (entriesData) => {
                    let totalHours = 0;
                    let totalOwed = 0;
                    let totalPaid = 0;

                    entriesData.forEach((entry) => {
                        // Only include complete entries in calculations
                        if (!isEntryComplete(entry)) {
                            return;
                        }

                        const hours = calculateHours(entry);
                        const pay =
                            hours * (parseFloat(entry.pay_rate) || hourlyRate);

                        totalHours += hours;
                        const paidAmount = parseFloat(entry.paid) || 0;
                        if (paidAmount > 0) {
                            totalPaid += paidAmount;
                        } else {
                            totalOwed += pay;
                        }
                    });

                    setStats({
                        totalHours: totalHours.toFixed(2),
                        totalPay: (totalOwed + totalPaid).toFixed(2),
                        totalOwed: totalOwed.toFixed(2),
                        totalPaid: totalPaid.toFixed(2),
                    });
                };

                const calculateHours = (entry) => {
                    if (!entry.start_time || !entry.end_time) return 0;

                    const start = new Date(`${entry.date} ${entry.start_time}`);
                    const end = new Date(`${entry.date} ${entry.end_time}`);
                    let totalMs = end - start;

                    if (entry.lunch_start && entry.lunch_end) {
                        const lunchStart = new Date(
                            `${entry.date} ${entry.lunch_start}`
                        );
                        const lunchEnd = new Date(
                            `${entry.date} ${entry.lunch_end}`
                        );
                        totalMs -= lunchEnd - lunchStart;
                    }

                    return Math.max(0, totalMs / (1000 * 60 * 60));
                };

                // FIXED: Set new entry with current hourly rate
                const addNewEntry = async () => {
                    const newEntry = {
                        date: '', // Empty date for new entries
                        start_time: '10:30', // 10:30 AM
                        lunch_start: '12:00', // 12:00 PM
                        lunch_end: '13:00', // 1:00 PM (1 hour lunch)
                        end_time: '15:30', // 3:30 PM
                        pay_rate: hourlyRate, // Use current rate
                        paid: 0.0,
                    };

                    try {
                        await axios.post(`${API_BASE}/entries.php`, newEntry);
                        fetchEntries();
                    } catch (error) {
                        console.error('Error adding entry:', error);
                        alert('Failed to add entry');
                    }
                };

                const updateField = async (id, field, value) => {
                    try {
                        let finalValue = value;

                        // Convert formats for database storage
                        if (field === 'date') {
                            finalValue = parseDateFromInput(value);
                        } else if (field.includes('time')) {
                            finalValue = parseTimeFromInput(value);
                        }

                        await axios.post(`${API_BASE}/update_entry.php`, {
                            id: id,
                            field: field,
                            value: finalValue,
                        });
                        fetchEntries();
                    } catch (error) {
                        console.error('Error updating field:', error);
                        alert('Failed to update entry');
                    }
                };

                const handlePayday = async (id, amount) => {
                    await updateField(id, 'paid', parseFloat(amount));
                    setPayingEntry(null);
                    setPayAmount('');
                };

                const deleteEntry = async (id) => {
                    if (!confirm('Are you sure you want to delete this entry?'))
                        return;

                    try {
                        await axios.delete(`${API_BASE}/entries.php`, {
                            data: { id },
                        });
                        fetchEntries();
                    } catch (error) {
                        console.error('Error deleting entry:', error);
                        alert('Failed to delete entry');
                    }
                };

                const startEdit = (entryId, field, currentValue) => {
                    setEditingCell(`${entryId}-${field}`);

                    let inputValue = currentValue || '';
                    if (field === 'date') {
                        inputValue = formatDateForInput(currentValue);
                    } else if (field.includes('time')) {
                        inputValue = formatTimeForInput(currentValue);
                    }

                    setEditValue(inputValue);
                };

                const saveEdit = (entryId, field) => {
                    updateField(entryId, field, editValue);
                    setEditingCell(null);
                };

                const cancelEdit = () => {
                    setEditingCell(null);
                    setEditValue('');
                };

                const handleKeyDown = (e, entryId, field) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        saveEdit(entryId, field);
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        cancelEdit();
                    }
                };

                const handleBlur = (entryId, field) => {
                    saveEdit(entryId, field);
                };

                // Sorting functionality
                const handleSort = (field) => {
                    if (sortField === field) {
                        setSortDirection(
                            sortDirection === 'asc' ? 'desc' : 'asc'
                        );
                    } else {
                        setSortField(field);
                        setSortDirection('asc');
                    }
                };

                const sortEntries = (entries) => {
                    return [...entries].sort((a, b) => {
                        let aVal, bVal;

                        if (sortField === 'date') {
                            aVal = a.date || '9999-12-31'; // Put empty dates at end
                            bVal = b.date || '9999-12-31';
                        } else if (sortField === 'hours') {
                            aVal = calculateHours(a);
                            bVal = calculateHours(b);
                        } else if (sortField === 'pay') {
                            aVal =
                                calculateHours(a) *
                                (parseFloat(a.pay_rate) || hourlyRate);
                            bVal =
                                calculateHours(b) *
                                (parseFloat(b.pay_rate) || hourlyRate);
                        } else {
                            aVal = a[sortField] || '';
                            bVal = b[sortField] || '';
                        }

                        if (sortDirection === 'asc') {
                            return (
                                aVal < bVal ? -1
                                : aVal > bVal ? 1
                                : 0
                            );
                        } else {
                            return (
                                aVal > bVal ? -1
                                : aVal < bVal ? 1
                                : 0
                            );
                        }
                    });
                };

                // Filter and pagination
                const filteredEntries = entries.filter((entry) => {
                    if (!searchDate) return true;
                    return entry.date && entry.date.includes(searchDate);
                });

                const sortedEntries = sortEntries(filteredEntries);
                const totalPages = Math.ceil(
                    sortedEntries.length / ENTRIES_PER_PAGE
                );
                const startIndex = (currentPage - 1) * ENTRIES_PER_PAGE;
                const paginatedEntries = sortedEntries.slice(
                    startIndex,
                    startIndex + ENTRIES_PER_PAGE
                );

                // Week/month separators
                const getRowClassName = (entry, index) => {
                    let className = '';

                    // Check if entry is new (no date)
                    if (!entry.date) {
                        className += 'new-entry-row ';
                    }

                    // Check if entry is paid
                    if (parseFloat(entry.paid) > 0) {
                        className += 'paid-row ';
                    }

                    // Check for week/month separators
                    if (entry.date) {
                        const entryDate = new Date(entry.date);
                        const dayOfWeek = entryDate.getDay();
                        const isLastDayOfMonth =
                            new Date(
                                entryDate.getFullYear(),
                                entryDate.getMonth() + 1,
                                0
                            ).getDate() === entryDate.getDate();

                        if (dayOfWeek === 0) {
                            // Sunday
                            className += 'week-separator ';
                        }
                        if (isLastDayOfMonth) {
                            className += 'month-separator ';
                        }
                    }

                    return className.trim();
                };

                const exportToCSV = () => {
                    const headers = [
                        'Date',
                        'Start',
                        'Lunch Start',
                        'Lunch End',
                        'End',
                        'Hours',
                        'Rate',
                        'Pay',
                        'Paid',
                    ];
                    const csvData = filteredEntries.map((entry) => [
                        formatDateForDisplay(entry.date),
                        formatTimeForDisplay(entry.start_time),
                        formatTimeForDisplay(entry.lunch_start),
                        formatTimeForDisplay(entry.lunch_end),
                        formatTimeForDisplay(entry.end_time),
                        calculateHours(entry).toFixed(2),
                        entry.pay_rate || hourlyRate,
                        (
                            calculateHours(entry) *
                            (entry.pay_rate || hourlyRate)
                        ).toFixed(2),
                        parseFloat(entry.paid) > 0 ?
                            `$${parseFloat(entry.paid).toFixed(2)}`
                        :   'No',
                    ]);

                    const csvContent = [headers, ...csvData]
                        .map((row) =>
                            row.map((field) => `"${field}"`).join(',')
                        )
                        .join('\n');

                    const blob = new Blob([csvContent], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `timesheet_${
                        new Date().toISOString().split('T')[0]
                    }.csv`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                };

                const renderCell = (entry, field) => {
                    const cellKey = `${entry.id}-${field}`;
                    const isEditing = editingCell === cellKey;
                    const value = entry[field] || '';

                    if (isEditing) {
                        return (
                            <div style={{ display: 'flex', gap: '0.25rem' }}>
                                <input
                                    type={
                                        field === 'date' ? 'date'
                                        : field.includes('time') ?
                                            'time'
                                        :   'text'
                                    }
                                    value={editValue}
                                    onChange={(e) =>
                                        setEditValue(e.target.value)
                                    }
                                    onKeyDown={(e) =>
                                        handleKeyDown(e, entry.id, field)
                                    }
                                    onBlur={() => handleBlur(entry.id, field)}
                                    className={
                                        field.includes('time') ? 'time-input'
                                        :   'edit-input'
                                    }
                                    autoFocus
                                />
                                <button
                                    className='btn btn-success btn-small'
                                    onClick={() => saveEdit(entry.id, field)}
                                >
                                    ✓
                                </button>
                                <button
                                    className='btn btn-danger btn-small'
                                    onClick={cancelEdit}
                                >
                                    ✗
                                </button>
                            </div>
                        );
                    }

                    // Display formatted values
                    let displayValue;
                    if (field === 'date') {
                        displayValue = formatDateForDisplay(value);
                    } else if (field.includes('time')) {
                        displayValue = formatTimeForDisplay(value);
                    } else {
                        displayValue = value || '-';
                    }

                    return (
                        <span
                            className='editable'
                            onClick={() => startEdit(entry.id, field, value)}
                            title='Click to edit'
                        >
                            {displayValue}
                        </span>
                    );
                };

                if (loading) {
                    return (
                        <div className='loading'>Loading timesheet data...</div>
                    );
                }

                return (
                    <div className='container'>
                        <div className='header'>
                            <h1 className='title'>Timesheet Dashboard</h1>
                            <button
                                className='btn btn-primary'
                                onClick={addNewEntry}
                            >
                                + Add New Day
                            </button>
                        </div>

                        <div className='stats-grid'>
                            <div className='stat-card'>
                                <div className='stat-title blue'>
                                    Total Hours
                                </div>
                                <div className='stat-value blue'>
                                    {stats.totalHours}
                                </div>
                            </div>
                            <div className='stat-card'>
                                <div className='stat-title green'>
                                    Total Earned
                                </div>
                                <div className='stat-value green'>
                                    ${stats.totalPay}
                                </div>
                            </div>
                            <div className='stat-card'>
                                <div className='stat-title yellow'>
                                    Amount Owed
                                </div>
                                <div className='stat-value yellow'>
                                    ${stats.totalOwed}
                                </div>
                            </div>
                            <div className='stat-card'>
                                <div className='stat-title purple'>
                                    Amount Paid
                                </div>
                                <div className='stat-value purple'>
                                    ${stats.totalPaid}
                                </div>
                            </div>
                        </div>

                        <div className='rate-section'>
                            <span style={{ fontWeight: '600' }}>
                                Hourly Rate:
                            </span>
                            {editingRate ?
                                <div
                                    style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.5rem',
                                    }}
                                >
                                    <span>$</span>
                                    <input
                                        type='number'
                                        step='0.01'
                                        value={hourlyRate}
                                        onChange={(e) =>
                                            setHourlyRate(
                                                parseFloat(e.target.value) || 0
                                            )
                                        }
                                        className='rate-input'
                                    />
                                    <button
                                        className='btn btn-success btn-small'
                                        onClick={() => {
                                            updateHourlyRate(hourlyRate);
                                            setEditingRate(false);
                                        }}
                                    >
                                        Save
                                    </button>
                                    <button
                                        className='btn btn-danger btn-small'
                                        onClick={() => {
                                            setEditingRate(false);
                                            loadHourlyRate(); // Reset to database value
                                        }}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            :   <span
                                    className='editable'
                                    onClick={() => setEditingRate(true)}
                                    style={{
                                        fontWeight: 'bold',
                                        fontSize: '1.1rem',
                                    }}
                                >
                                    ${hourlyRate.toFixed(2)}
                                </span>
                            }
                            <button
                                className='btn btn-success'
                                onClick={exportToCSV}
                                style={{ marginLeft: 'auto' }}
                            >
                                Export CSV
                            </button>
                        </div>

                        <div className='search-section'>
                            <span style={{ fontWeight: '600' }}>
                                Search by Date:
                            </span>
                            <input
                                type='date'
                                value={searchDate}
                                onChange={(e) => setSearchDate(e.target.value)}
                                className='search-input'
                            />
                            <button
                                className='btn btn-danger btn-small'
                                onClick={() => setSearchDate('')}
                            >
                                Clear
                            </button>
                        </div>

                        <div className='table-container'>
                            <table>
                                <thead>
                                    <tr>
                                        <th
                                            className={`sortable ${
                                                sortField === 'date' ?
                                                    `sort-${sortDirection}`
                                                :   ''
                                            }`}
                                            onClick={() => handleSort('date')}
                                        >
                                            Date
                                        </th>
                                        <th>Start</th>
                                        <th>Lunch Start</th>
                                        <th>Lunch End</th>
                                        <th>End</th>
                                        <th
                                            className={`sortable ${
                                                sortField === 'hours' ?
                                                    `sort-${sortDirection}`
                                                :   ''
                                            }`}
                                            onClick={() => handleSort('hours')}
                                        >
                                            Hours
                                        </th>
                                        <th>Rate</th>
                                        <th
                                            className={`sortable ${
                                                sortField === 'pay' ?
                                                    `sort-${sortDirection}`
                                                :   ''
                                            }`}
                                            onClick={() => handleSort('pay')}
                                        >
                                            Pay
                                        </th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {paginatedEntries.length === 0 ?
                                        <tr>
                                            <td
                                                colSpan='10'
                                                className='empty-state'
                                            >
                                                No timesheet entries found.
                                                Click "Add New Day" to get
                                                started!
                                            </td>
                                        </tr>
                                    :   paginatedEntries.map((entry, index) => {
                                            const hours = calculateHours(entry);
                                            const pay =
                                                hours *
                                                (parseFloat(entry.pay_rate) ||
                                                    hourlyRate);
                                            const paidAmount =
                                                parseFloat(entry.paid) || 0;

                                            return (
                                                <tr
                                                    key={entry.id}
                                                    className={getRowClassName(
                                                        entry,
                                                        index
                                                    )}
                                                >
                                                    <td>
                                                        {renderCell(
                                                            entry,
                                                            'date'
                                                        )}
                                                    </td>
                                                    <td>
                                                        {renderCell(
                                                            entry,
                                                            'start_time'
                                                        )}
                                                    </td>
                                                    <td>
                                                        {renderCell(
                                                            entry,
                                                            'lunch_start'
                                                        )}
                                                    </td>
                                                    <td>
                                                        {renderCell(
                                                            entry,
                                                            'lunch_end'
                                                        )}
                                                    </td>
                                                    <td>
                                                        {renderCell(
                                                            entry,
                                                            'end_time'
                                                        )}
                                                    </td>
                                                    <td
                                                        style={{
                                                            fontFamily:
                                                                'monospace',
                                                        }}
                                                    >
                                                        {(
                                                            isEntryComplete(
                                                                entry
                                                            )
                                                        ) ?
                                                            hours.toFixed(2)
                                                        :   '-'}
                                                    </td>
                                                    <td>
                                                        $
                                                        {renderCell(
                                                            entry,
                                                            'pay_rate'
                                                        )}
                                                    </td>
                                                    <td
                                                        style={{
                                                            fontFamily:
                                                                'monospace',
                                                        }}
                                                    >
                                                        {(
                                                            isEntryComplete(
                                                                entry
                                                            )
                                                        ) ?
                                                            `$${pay.toFixed(2)}`
                                                        :   '-'}
                                                    </td>
                                                    <td>
                                                        <span
                                                            className={`status-badge ${
                                                                paidAmount > 0 ?
                                                                    'status-paid'
                                                                :   'status-pending'
                                                            }`}
                                                        >
                                                            {paidAmount > 0 ?
                                                                `Paid $${paidAmount.toFixed(2)}`
                                                            :   'Pending'}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <div className='actions'>
                                                            {paidAmount === 0 &&
                                                                ((
                                                                    payingEntry ===
                                                                    entry.id
                                                                ) ?
                                                                    <div className='payday-input'>
                                                                        <span>
                                                                            $
                                                                        </span>
                                                                        <input
                                                                            type='number'
                                                                            step='0.01'
                                                                            value={
                                                                                payAmount
                                                                            }
                                                                            onChange={(
                                                                                e
                                                                            ) =>
                                                                                setPayAmount(
                                                                                    e
                                                                                        .target
                                                                                        .value
                                                                                )
                                                                            }
                                                                            placeholder={
                                                                                (
                                                                                    isEntryComplete(
                                                                                        entry
                                                                                    )
                                                                                ) ?
                                                                                    pay.toFixed(
                                                                                        2
                                                                                    )
                                                                                :   '0.00'
                                                                            }
                                                                        />
                                                                        <button
                                                                            className='btn btn-success btn-small'
                                                                            onClick={() =>
                                                                                handlePayday(
                                                                                    entry.id,
                                                                                    payAmount ||
                                                                                        ((
                                                                                            isEntryComplete(
                                                                                                entry
                                                                                            )
                                                                                        ) ?
                                                                                            pay.toFixed(
                                                                                                2
                                                                                            )
                                                                                        :   '0.00')
                                                                                )
                                                                            }
                                                                        >
                                                                            ✓
                                                                        </button>
                                                                        <button
                                                                            className='btn btn-danger btn-small'
                                                                            onClick={() => {
                                                                                setPayingEntry(
                                                                                    null
                                                                                );
                                                                                setPayAmount(
                                                                                    ''
                                                                                );
                                                                            }}
                                                                        >
                                                                            ✗
                                                                        </button>
                                                                    </div>
                                                                :   <button
                                                                        className='btn btn-success btn-small'
                                                                        onClick={() => {
                                                                            setPayingEntry(
                                                                                entry.id
                                                                            );
                                                                            setPayAmount(
                                                                                (
                                                                                    isEntryComplete(
                                                                                        entry
                                                                                    )
                                                                                ) ?
                                                                                    pay.toFixed(
                                                                                        2
                                                                                    )
                                                                                :   '0.00'
                                                                            );
                                                                        }}
                                                                        title='Payday'
                                                                        disabled={
                                                                            !isEntryComplete(
                                                                                entry
                                                                            )
                                                                        }
                                                                    >
                                                                        💰
                                                                    </button>)}
                                                            <button
                                                                className='btn btn-danger btn-small'
                                                                onClick={() =>
                                                                    deleteEntry(
                                                                        entry.id
                                                                    )
                                                                }
                                                                title='Delete Entry'
                                                            >
                                                                🗑️
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            );
                                        })
                                    }
                                </tbody>
                            </table>
                        </div>

                        {totalPages > 1 && (
                            <div className='pagination'>
                                <div>
                                    Showing {startIndex + 1}-
                                    {Math.min(
                                        startIndex + ENTRIES_PER_PAGE,
                                        sortedEntries.length
                                    )}{' '}
                                    of {sortedEntries.length} entries
                                </div>
                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                    <button
                                        className='btn btn-primary btn-small'
                                        onClick={() =>
                                            setCurrentPage(currentPage - 1)
                                        }
                                        disabled={currentPage === 1}
                                    >
                                        Previous
                                    </button>
                                    <span style={{ padding: '0.5rem' }}>
                                        Page {currentPage} of {totalPages}
                                    </span>
                                    <button
                                        className='btn btn-primary btn-small'
                                        onClick={() =>
                                            setCurrentPage(currentPage + 1)
                                        }
                                        disabled={currentPage === totalPages}
                                    >
                                        Next
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            ReactDOM.render(<TimesheetApp />, document.getElementById('root'));
        </script>
    </body>
</html>
